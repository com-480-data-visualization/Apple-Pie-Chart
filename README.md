# Apple Pie Chart – Frontend

This README explains how to  

1. run the Next‑js frontend locally;  
2. build a static version;  
3. publish / update the GitHub Pages site ( `web` branch, `/docs` folder).

The instructions already include every change we made in this conversation:  

• `output: 'export'` in *next.config.mjs*  
• `basePath` + `assetPrefix` = **/Apple-Pie-Chart**  
• public images referenced with that prefix  
• automatic deletion of inner `.gitignore` + creation of `.nojekyll`  
• single‑line Yarn script using **cross‑env** (so macOS / Linux / Windows all work).

---

## 0. Prerequisites

* Node ≥ 18  
* Yarn (v1 or v3)  
* Your working branch for GitHub Pages is  `web`  (Settings → Pages → Source → `web` / `docs`)

```
repo‑root
├─ docs/               # what GitHub Pages serves
└─ website/
   └─ frontend/        # Next.js project root
```

---

## 1 – Run locally (dev mode)

```bash
# 1. go to Next project root
cd website/frontend

# 2. install dependencies
yarn install        # first time only

# 3. start dev server
yarn dev            # http://localhost:3000
```

The site opens without **/Apple‑Pie‑Chart** prefix in URLs, because
`NEXT_PUBLIC_BASE_PATH` is *not* set while developing.

---

## 2 – Preview the exported site locally (optional)

```bash
# build in dev‑style (no basePath) and export
yarn build

# serve the generated static files in "out"
npx serve out        # http://localhost:3000
```

---

## 3 – Build & export for production (GitHub Pages)

A single command does *all* of this:

* sets the required environment variables;  
* `next build` (in export mode) → creates `out/`;  
* copies the result to repo‑root `docs/`;  
* removes the autogenerated inner `.gitignore` files;  
* writes an empty `.nojekyll` file (GitHub Pages must not run Jekyll).

```bash
cd website/frontend
yarn deploy
```

`package.json` excerpt ( already committed ):

```jsonc
"scripts": {
  "dev":    "next dev",
  "deploy": "cross-env NEXT_PUBLIC_BASE_PATH=/Apple-Pie-Chart NEXT_PUBLIC_GH_PAGES=true next build && rm -rf ../../docs && cp -R out ../../docs && find ../../docs/_next -name '.gitignore' -delete && touch ../../docs/.nojekyll"
}
```

The environment variable `NEXT_PUBLIC_BASE_PATH` is used in code to build correct image URLs:

```tsx
const prefix = process.env.NEXT_PUBLIC_BASE_PATH || '';
<img src={`${prefix}/1.jpeg`} alt="chords1" />
```

---

## 4 – Commit & push the new static site

```bash
# from repo root
cd ../../          # ensure you are at repo‑root, not inside frontend
git add -A docs    # include deletions & additions
git commit -m "deploy: update docs"
git push origin web
```
```
https://<username>.github.io/Apple-Pie-Chart/
```

---

## 5 – Full release checklist

1. `git switch web`                        ( stay on the branch served by Pages )  
2. `cd website/frontend`  
3. `yarn deploy`  
4. `cd ../../`  
5. `git add -A docs`  
6. `git commit -m "deploy: …"`  
7. `git push origin web`  
8. Visit the URL above ‑ press *Ctrl/⌘ + Shift + R* if the browser cached old files.

---

Happy chord‑exploring!